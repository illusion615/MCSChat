<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCSChat - Advanced Chatbot Interface</title>
    <meta name="description"
        content="Sophisticated chatbot interface with multi-agent support, AI companion features, and real-time streaming capabilities">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/chat-new.svg">

    <!-- External Stylesheets -->
    <link rel="stylesheet" href="styles.css">

    <!-- External Libraries -->
    <!-- Adaptive Cards SDK -->
    <script src="https://unpkg.com/adaptivecards@2.9.0/dist/adaptivecards.min.js"></script>
    <!-- Bot Framework DirectLine JS -->
    <script src="https://unpkg.com/botframework-directlinejs@0.11.6/dist/directline.js"></script>
    <!-- Markdown Parser (local) -->
    <script src="lib/marked.min.js"></script>
    <!-- HTML Sanitizer (local) -->
    <script src="lib/purify.min.js"></script>

    <!-- Fallback for offline usage -->
    <script>
        // Check if libraries loaded successfully, provide fallbacks if needed
        document.addEventListener('DOMContentLoaded', () => {
            const missingLibraries = [];

            if (typeof DirectLine === 'undefined') {
                console.error('DirectLine library failed to load');
                missingLibraries.push('DirectLine');
            }
            if (typeof marked === 'undefined') {
                console.error('Marked.js library failed to load');
                missingLibraries.push('marked');
            }
            if (typeof DOMPurify === 'undefined') {
                console.error('DOMPurify library failed to load');
                missingLibraries.push('DOMPurify');
            }

            if (missingLibraries.length > 0) {
                console.warn(`Missing libraries: ${missingLibraries.join(', ')}. Application may not function properly.`);

                // Show error message to user
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #f8d7da;
                    color: #721c24;
                    padding: 15px;
                    border-radius: 8px;
                    border: 1px solid #f5c6cb;
                    z-index: 10000;
                    font-family: Arial, sans-serif;
                    max-width: 350px;
                `;
                errorDiv.innerHTML = `
                    <strong>Library Loading Error</strong><br>
                    Failed to load: ${missingLibraries.join(', ')}<br>
                    <small>Please check your internet connection.</small>
                `;
                document.body.appendChild(errorDiv);

                setTimeout(() => errorDiv.remove(), 10000);
            } else {
                console.log('All markdown libraries loaded successfully');
                console.log('marked version:', marked?.VERSION || 'unknown');
                console.log('marked.parse available:', typeof marked.parse === 'function');
                console.log('DirectLine available:', typeof DirectLine !== 'undefined');
            }
        });
    </script>
</head>

<body>
    <!-- Main Application Container -->
    <div id="container">
        <!-- Left Sidebar Panel -->
        <div id="leftPanel">
            <!-- History Header -->
            <div id="historyHeader">
                <h3>History Conversations</h3>
                <button id="toggleLLMPanelBtn" class="icon-button" title="Toggle AI Companion Panel"
                    style="display: none;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z" />
                    </svg>
                </button>
                <button id="clearButton" class="icon-button" title="New chat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4C22,2.89 21.1,2 20,2M13,14H11V12H13M13,10H11V6H13M7,14H9V12H7M7,10H9V6H7M17,14H15V12H17M17,10H15V6H17" />
                    </svg>
                </button>
                <button id="setupButton" class="icon-button" title="Settings">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z" />
                    </svg>
                </button>
                <button id="clearAllHistoryButton" class="icon-button" title="Clear All History">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z" />
                    </svg>
                </button>
            </div>
            <!-- Session List -->
            <div id="sessionList">
                <div class="loading-sessions">Loading chat history...</div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div id="mainChatArea">
            <!-- Agent Chat Panel -->
            <div id="agentChatPanel" class="chat-panel">
                <div class="panel-header">
                    <h3 id="agentConversationTitle">Agent Conversation</h3>
                    <div class="panel-controls">
                        <span id="agentStatus" class="status-indicator" data-tooltip="Agent: Disconnected"></span>
                        <span id="agentName" class="agent-name"></span>
                    </div>
                </div>

                <!-- Chat Window -->
                <div id="chatWindow" class="chat-window">
                    <div class="welcome-message">
                        <div class="welcome-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2Z" />
                            </svg>
                        </div>
                        <h4>Welcome to MCSChat</h4>
                        <p>Connect with your AI agent to start a conversation. Configure your bot in settings or start
                            typing to begin.</p>
                    </div>
                </div>

                <!-- Suggested Actions Container -->
                <div id="suggestedActionsContainer"></div>

                <!-- Input Container -->
                <div id="inputContainer">
                    <!-- File Upload -->
                    <div id="fileUploadContainer">
                        <input type="file" id="fileInput"
                            accept=".pdf,.doc,.docx,.txt,.xlsx,.pptx,.png,.jpg,.jpeg,.gif,.webp"
                            style="display: none;" />
                        <button id="attachButton" class="input-button" title="Attach file" aria-label="Attach file">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66L9.64 16.2a2 2 0 01-2.83-2.83l8.48-8.48" />
                            </svg>
                        </button>
                    </div>
                    <!-- Message Input -->
                    <input type="text" id="userInput" placeholder="Type your message..." autocomplete="off"
                        aria-label="Message input" />
                    <!-- Send Button -->
                    <button id="sendButton" class="input-button primary" title="Send message" aria-label="Send message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="m2 21 21-9L2 3v7l15 2-15 2v7Z" />
                        </svg>
                    </button>
                </div>

                <!-- File Preview Container -->
                <div id="filePreviewContainer" style="display: none;">
                    <div id="filePreview">
                        <div class="file-info">
                            <span id="fileName">filename.txt</span>
                            <span id="fileSize">1.2 KB</span>
                        </div>
                        <button id="removeFileButton" class="remove-file-btn" title="Remove file"
                            aria-label="Remove file">
                            &times;
                        </button>
                    </div>
                </div>
            </div>

            <!-- AI Companion Panel -->
            <div id="llmAnalysisPanel" class="chat-panel collapsed" style="display: none;">
                <div class="panel-header">
                    <h3>Agent Performance</h3>
                    <div class="panel-controls">
                        <span id="llmStatus" class="status-indicator"></span>
                        <span id="llmModelName" class="agent-name"></span>
                    </div>
                </div>

                <!-- Real-time KPI Section -->
                <div id="agentKpiSection" class="kpi-section">
                    <div class="kpi-grid">
                        <div class="kpi-item">
                            <div class="kpi-label">Accuracy</div>
                            <div class="kpi-value" id="kpiAccuracy">-/10</div>
                            <div class="kpi-bar">
                                <div class="kpi-progress" id="kpiAccuracyBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="kpi-item">
                            <div class="kpi-label">Helpfulness</div>
                            <div class="kpi-value" id="kpiHelpfulness">-/10</div>
                            <div class="kpi-bar">
                                <div class="kpi-progress" id="kpiHelpfulnessBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="kpi-item">
                            <div class="kpi-label">Completeness</div>
                            <div class="kpi-value" id="kpiCompleteness">-/10</div>
                            <div class="kpi-bar">
                                <div class="kpi-progress" id="kpiCompletenessBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="kpi-item">
                            <div class="kpi-label">Human-Likeness</div>
                            <div class="kpi-value" id="kpiHumanlikeness">-/10</div>
                            <div class="kpi-bar">
                                <div class="kpi-progress" id="kpiHumanlikenessBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="kpi-item">
                            <div class="kpi-label">Efficiency</div>
                            <div class="kpi-value" id="kpiEfficiency">-/10</div>
                            <div class="kpi-bar">
                                <div class="kpi-progress" id="kpiEfficiencyBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="kpi-item">
                            <div class="kpi-label">Changes</div>
                            <div class="kpi-value">
                                <span id="kpiChanges">0</span>
                                <div class="kpi-trend" id="kpiChangesTrend">
                                    <span class="trend-arrow stable">→</span>
                                    <span class="trend-text">Stable</span>
                                </div>
                            </div>
                            <div class="kpi-bar">
                                <div class="kpi-progress" id="kpiChangesBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KPI Detail Modal -->
                <div id="kpiModal" class="kpi-modal">
                    <div class="kpi-modal-content">
                        <div class="kpi-modal-header">
                            <h3 id="kpiModalTitle">Score Details</h3>
                            <button class="kpi-modal-close" id="kpiModalClose">&times;</button>
                        </div>
                        <div class="kpi-modal-body">
                            <div class="kpi-score-display">
                                <span class="kpi-score-label">Current Score:</span>
                                <span class="kpi-score-value" id="kpiModalScore">-/10</span>
                            </div>
                            <div class="kpi-explanation" id="kpiModalExplanation">
                                <h4>How this score is calculated:</h4>
                                <div class="calculation-details" id="kpiModalDetails">
                                    <!-- Dynamic content will be inserted here -->
                                </div>
                            </div>
                            <div class="conversation-context" id="kpiModalContext">
                                <h4>Based on conversation analysis:</h4>
                                <div class="context-messages" id="kpiModalMessages">
                                    <!-- Dynamic content will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Chat Window -->
                <div id="llmChatWindow" class="chat-window">
                    <div class="companion-welcome">
                        <div class="companion-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2Z" />
                            </svg>
                        </div>
                        <p>AI Companion ready to analyze conversations and provide insights.</p>
                    </div>
                </div>

                <!-- AI Input Container -->
                <div id="llmInputContainer">
                    <!-- Quick Actions -->
                    <div class="llm-quick-actions">
                        <button class="quick-action-btn" data-action="analyze" title="Analyze agent responses">
                            Analyze Response
                        </button>
                        <button class="quick-action-btn" data-action="summarize" title="Summarize conversation">
                            Summarize Chat
                        </button>
                    </div>

                    <!-- Context Indicator -->
                    <div class="context-indicator">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" />
                        </svg>
                        <span>Full conversation context automatically included (adaptive)</span>
                    </div>

                    <!-- AI Input Field -->
                    <div id="llmInputField">
                        <textarea id="llmUserInput" placeholder="Ask AI companion to analyze agent performance..."
                            rows="2" aria-label="AI companion input"></textarea>
                        <button id="llmSendButton" class="input-button primary" title="Send to AI companion"
                            aria-label="Send to AI companion">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="m2 21 21-9L2 3v7l15 2-15 2v7Z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Drag Bar for Resizing -->
        <div id="dragBar" style="display: none;"></div>

        <!-- Right Panel for External Content -->
        <div id="rightPanel" style="display: none;">
            <div class="panel-header">
                <h3>External Content</h3>
                <button id="closeButton" class="close-button" title="Close panel" aria-label="Close panel">
                    &times;
                </button>
            </div>
            <iframe id="embeddedBrowser" style="width: 100%; height: calc(100% - 60px); border: none;"
                title="External content frame"></iframe>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal" role="dialog" aria-labelledby="imageModalTitle" aria-hidden="true">
        <span class="closeModal" title="Close image" aria-label="Close image">&times;</span>
        <img class="modal-content" id="enlargedImage" alt="Enlarged image" />
        <div id="imageModalTitle" class="sr-only">Enlarged Image View</div>
    </div>

    <!-- Setup Modal -->
    <div id="setupModal" class="modal" role="dialog" aria-labelledby="setupModalTitle" aria-hidden="true">
        <div class="modal-content setup-modal">
            <div class="modal-header">
                <h2 id="setupModalTitle">Bot Configuration</h2>
                <button class="kpi-modal-close" id="closeSetupModal" title="Close configuration"
                    aria-label="Close configuration">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Settings Navigation -->
                <div class="settings-navigation">
                    <ul class="nav-list">
                        <li><a href="#agent-section" class="nav-item active" data-section="agent-section">Agent
                                Management</a></li>
                        <li><a href="#ai-companion-section" class="nav-item" data-section="ai-companion-section">AI
                                Companion</a></li>
                        <li><a href="#appearance-section" class="nav-item"
                                data-section="appearance-section">Appearance</a></li>
                    </ul>
                </div>

                <!-- Settings Content -->
                <div class="settings-content">
                    <!-- Agent Management Section -->
                    <div id="agent-section" class="settings-section active">
                        <h3 class="section-title">Agent Management</h3>

                        <!-- Agent Management -->
                        <div class="form-group">
                            <div class="agents-header">
                                <label for="agentsList">Configured Agents:</label>
                                <button type="button" id="addNewAgentBtn" class="btn btn-secondary btn-small"
                                    title="Add new agent">+ Add New Agent</button>
                            </div>
                            <div id="agentsList" class="agents-list" role="list">
                                <div class="no-agents-message">No agents configured. Click "Add New Agent" to create
                                    your first
                                    agent.</div>
                            </div>
                        </div>

                        <!-- Agent Configuration Section -->
                        <div id="agentConfigSection" style="display: none;">
                            <div class="config-header">
                                <h3 id="configTitle">Add New Agent</h3>
                                <button type="button" id="cancelConfigBtn"
                                    class="btn btn-secondary btn-small">Cancel</button>
                            </div>

                            <div class="form-group">
                                <label for="agentNameInput">Agent Name:</label>
                                <input type="text" id="agentNameInput"
                                    placeholder="Enter agent name (e.g., Customer Support Bot)"
                                    aria-describedby="agentNameHelp" />
                                <small id="agentNameHelp" class="help-text">A friendly name to identify this
                                    agent</small>
                            </div>

                            <div class="form-group">
                                <label for="secretInput">DirectLine Secret:</label>
                                <div class="input-with-button">
                                    <input type="password" id="secretInput"
                                        placeholder="Enter your DirectLine secret..." aria-describedby="secretHelp" />
                                    <button type="button" id="toggleSecretVisibility" title="Show/Hide secret"
                                        aria-label="Toggle secret visibility">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"
                                            id="eyeIcon">
                                            <path
                                                d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" />
                                        </svg>
                                    </button>
                                </div>
                                <small id="secretHelp" class="help-text">DirectLine secret from Azure Bot Service for
                                    this
                                    agent</small>
                            </div>

                            <div class="form-group">
                                <div class="connection-status" id="connectionStatus">
                                    <span class="status-indicator" id="statusIndicator"></span>
                                    <span class="status-text" id="statusText">Not connected</span>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" id="testAgentBtn" class="btn btn-secondary"
                                    title="Test DirectLine connection">Test Connection</button>
                                <button type="button" id="saveAgentBtn" class="btn btn-primary"
                                    title="Save agent configuration">Save Agent</button>
                            </div>
                        </div>

                        <!-- Current Active Agent Display -->
                        <div class="form-group">
                            <label>Currently Active Agent:</label>
                            <div class="current-agent-display" id="currentAgentDisplay">
                                <span id="currentAgentName">No agent selected</span>
                                <span class="agent-status disconnected" id="currentAgentStatus">Disconnected</span>
                            </div>
                        </div>

                        <!-- Streaming Options - moved here -->
                        <div class="form-group">
                            <label>Agent Options:</label>
                            <div class="feature-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableStreamingCheckbox" />
                                    <span class="checkmark"></span>
                                    Enable streaming responses (simulation mode)
                                </label>
                                <small class="help-text">Simulates progressive response display for better UX</small>

                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableSideBrowserCheckbox" />
                                    <span class="checkmark"></span>
                                    Open citations in side browser
                                </label>
                                <small class="help-text">View citation sources within the app instead of external
                                    browser</small>

                                <label class="checkbox-label">
                                    <input type="checkbox" id="fullWidthMessagesCheckbox" />
                                    <span class="checkmark"></span>
                                    Display agent messages in full width
                                </label>
                                <small class="help-text">Show agent responses across the full panel width for maximum
                                    information display</small>
                            </div>
                        </div>
                    </div>

                    <!-- AI Companion Section -->
                    <div id="ai-companion-section" class="settings-section">
                        <h3 class="section-title">AI Companion</h3>

                        <!-- AI Companion Enable/Disable -->
                        <div class="form-group">
                            <label>AI Companion Settings:</label>
                            <div class="feature-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableLLMCheckbox" />
                                    <span class="checkmark"></span>
                                    Enable AI Companion (requires API key or local Ollama)
                                </label>
                                <small class="help-text">AI assistant for conversation analysis and insights</small>
                            </div>
                        </div>

                        <!-- API Configuration Section -->
                        <div id="apiKeySection" style="display: none;">
                            <div class="form-group">
                                <label for="apiProviderSelect">AI Provider:</label>
                                <select id="apiProviderSelect" aria-describedby="providerHelp">
                                    <option value="openai">OpenAI GPT</option>
                                    <option value="anthropic">Anthropic Claude</option>
                                    <option value="azure">Azure OpenAI</option>
                                    <option value="ollama">Local Ollama</option>
                                </select>
                                <small id="providerHelp" class="help-text">Choose your preferred AI provider</small>
                            </div>

                            <!-- API Key Field -->
                            <div id="apiKeyField" class="form-group">
                                <label for="apiKeyInput">API Key:</label>
                                <input type="password" id="apiKeyInput" placeholder="Enter your API key..."
                                    aria-describedby="apiKeyHelp" />
                                <small id="apiKeyHelp" class="help-text">API key for the selected provider</small>
                            </div>

                            <!-- Azure OpenAI Configuration -->
                            <div id="azureConfig" style="display: none;">
                                <div class="form-group">
                                    <label for="azureEndpointInput">Azure Endpoint:</label>
                                    <input type="url" id="azureEndpointInput"
                                        placeholder="https://your-resource.openai.azure.com"
                                        aria-describedby="azureEndpointHelp" />
                                    <small id="azureEndpointHelp" class="help-text">Azure OpenAI service endpoint
                                        URL</small>
                                </div>

                                <div class="form-group">
                                    <label for="azureDeploymentInput">Deployment Name:</label>
                                    <input type="text" id="azureDeploymentInput" placeholder="gpt-4o-mini"
                                        aria-describedby="azureDeploymentHelp" />
                                    <small id="azureDeploymentHelp" class="help-text">Azure OpenAI deployment model
                                        name</small>
                                </div>

                                <div class="form-group">
                                    <label for="azureApiVersionInput">API Version:</label>
                                    <input type="text" id="azureApiVersionInput" placeholder="2024-02-01"
                                        value="2024-02-01" aria-describedby="azureApiVersionHelp" />
                                    <small id="azureApiVersionHelp" class="help-text">Azure OpenAI API version</small>
                                </div>

                                <div class="form-group">
                                    <button type="button" id="testAzureBtn" class="btn btn-secondary">
                                        Test Azure OpenAI Connection
                                    </button>
                                </div>
                            </div>

                            <!-- General API Test Button -->
                            <div id="apiTestSection" style="display: none;">
                                <div class="form-group">
                                    <button type="button" id="testApiBtn" class="btn btn-secondary">
                                        Test API Connection
                                    </button>
                                </div>
                            </div>

                            <!-- Ollama Configuration -->
                            <div id="ollamaConfig" style="display: none;">
                                <div class="form-group">
                                    <label for="ollamaUrlInput">Ollama Server URL:</label>
                                    <input type="url" id="ollamaUrlInput" placeholder="http://localhost:11434"
                                        value="http://localhost:11434" aria-describedby="ollamaUrlHelp" />
                                    <small id="ollamaUrlHelp" class="help-text">URL of your local Ollama server</small>
                                </div>

                                <div class="form-group">
                                    <label for="ollamaModelSelect">Available Models:</label>
                                    <div style="display: flex; gap: 8px; align-items: end;">
                                        <select id="ollamaModelSelect" style="flex: 1;" aria-describedby="modelHelp">
                                            <option value="">Select a model...</option>
                                        </select>
                                        <button type="button" id="refreshModelsBtn" class="btn btn-secondary btn-small">
                                            Refresh Models
                                        </button>
                                    </div>
                                    <small id="modelHelp" class="help-text">Models available on your Ollama
                                        server</small>
                                </div>

                                <div class="form-group">
                                    <button type="button" id="testOllamaBtn" class="btn btn-secondary">
                                        Test Ollama Connection
                                    </button>
                                </div>

                                <!-- Hidden field for backward compatibility -->
                                <input type="hidden" id="ollamaModelInput" />
                            </div>
                        </div>
                    </div>

                    <!-- Appearance Section -->
                    <div id="appearance-section" class="settings-section">
                        <h3 class="section-title">Appearance</h3>

                        <!-- Font Size Configuration - moved to bottom -->
                        <div class="form-group">
                            <label>Font Size Settings:</label>
                            <div class="font-size-config">
                                <!-- Agent Chat Font Size -->
                                <div class="font-size-setting">
                                    <label for="agentFontSize">Agent Chat Font Size:</label>
                                    <div style="display: flex; align-items: center; gap: 8px; margin-top: 5px;">
                                        <input type="range" id="agentFontSize" min="10" max="20" value="15" step="1"
                                            style="flex: 1;" aria-describedby="agentFontHelp" />
                                        <span id="agentFontSizeValue" class="font-size-value">15px</span>
                                    </div>
                                    <small id="agentFontHelp" class="help-text">Adjust font size for agent conversation
                                        messages</small>
                                </div>

                                <!-- AI Companion Font Size -->
                                <div class="font-size-setting" style="margin-top: 12px;">
                                    <label for="companionFontSize">AI Companion Font Size:</label>
                                    <div style="display: flex; align-items: center; gap: 8px; margin-top: 5px;">
                                        <input type="range" id="companionFontSize" min="8" max="16" value="12" step="1"
                                            style="flex: 1;" aria-describedby="companionFontHelp" />
                                        <span id="companionFontSizeValue" class="font-size-value">12px</span>
                                    </div>
                                    <small id="companionFontHelp" class="help-text">Adjust font size for AI companion
                                        messages</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="loading-indicator" style="display: none;">
        <div class="loading-spinner"></div>
        <span class="loading-text">Initializing...</span>
    </div>

    <!-- Side Browser for Citations -->
    <div id="sideBrowser" class="side-browser">
        <div class="side-browser-header">
            <h3 id="sideBrowserTitle">Citation Source</h3>
            <button id="closeSideBrowser" class="side-browser-close" title="Close browser">×</button>
        </div>
        <div id="sideBrowserContent" class="side-browser-content">
            <iframe id="sideBrowserFrame" src="about:blank" title="Citation content"></iframe>
            <div id="sideBrowserLoader" class="side-browser-loader">
                <div class="loader-spinner"></div>
                <p>Loading citation source...</p>
            </div>
            <div id="sideBrowserError" class="side-browser-error" style="display: none;">
                <p>Unable to load citation source. This content may be blocked by security policies.</p>
                <button id="openExternalBtn" class="btn btn-secondary">Open in External Browser</button>
            </div>
        </div>
    </div>

    <!-- Screen Reader Only Content -->
    <div class="sr-only">
        <div id="liveRegion" aria-live="polite" aria-atomic="false"></div>
    </div>

    <!-- Application Scripts -->
    <script type="module" src="src/main.js"></script>
</body>

</html>