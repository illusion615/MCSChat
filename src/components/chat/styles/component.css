@import url('./tokens.css');

:host { all: initial; contain: content; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; color: var(--text, #222); display: block; width: 100%; height: 100%; }
:host([theme="dark"]) { --bg:#1a1a1a; --text:#f5f5f5; --muted:#a0a0a0; --border:#2a2a2a; --assistant-bg:#222; --assistant-text:#f5f5f5; --user-text:#ffffff; }

chat-container { display: grid; grid-template-rows: auto 1fr auto; grid-template-areas: "header" "messages" "input"; background: var(--bg, #f5f5f5); height: 100%; }
chat-header { grid-area: header; display:flex; align-items:center; justify-content:space-between; padding:16px 20px; background:#fff; border-bottom:1px solid var(--border, #e5e5e5); }
conversation-title { font-size: 15px; font-weight: 600; color: #111; line-height: 1.3; }
header-actions { display:flex; align-items:center; gap:16px; }
search-container { display:flex; align-items:center; gap:8px; }
search-container:not([data-visible="true"]) { display:none; }
search-toggle { width:32px; height:32px; border:1px solid var(--border, #e5e5e5); border-radius:8px; cursor:pointer; position:relative; background:#fff; }
search-toggle::before { content:''; position:absolute; inset:8px; border:1.5px solid var(--muted, #6b7280); border-radius:50%; }
search-toggle::after { content:''; position:absolute; right:6px; bottom:6px; width:6px; height:2px; background: var(--muted, #6b7280); transform: rotate(45deg); transform-origin: right bottom; }
search-box { display:none; align-items:center; gap:6px; }
search-container[data-open="true"] search-box { display:flex; }
search-box input { border:1px solid var(--border, #e5e5e5); border-radius:10px; padding:8px 12px; background:#fff; color: var(--text); font: inherit; width: 220px; font-size: 14px; }
search-close { width:28px; height:28px; border:1px solid var(--border, #e5e5e5); border-radius:6px; cursor:pointer; position:relative; background:#fff; }
search-close::before, search-close::after { content:''; position:absolute; left:8px; right:8px; top:13px; height:1.5px; background: var(--muted, #6b7280); }
search-close::before { transform: rotate(45deg); }
search-close::after { transform: rotate(-45deg); }
agent-status { display:flex; flex-direction:column; align-items:flex-end; gap:3px; font-size:13px; line-height: 1.2; }
status-indicator { color:#10b981; font-weight:500; }
model-info { color: var(--muted, #6b7280); font-size: 12px; }
messages-area { grid-area: messages; padding:20px 24px; overflow:auto; display:flex; flex-direction:column; gap:var(--gap, 20px); background: var(--bg, #f5f5f5); }

/* Message Container - outer wrapper */
message-container { display:flex; align-items:flex-start; gap:12px; max-width:75%; }
message-container[type="user"] { align-self:flex-end; flex-direction:row-reverse; max-width:65%; }
message-container[type="assistant"] { align-self:flex-start; flex-direction:row; }
message-container[type="system"] { align-self:center; justify-content:center; }

/* Avatar positioning */
avatar-container { margin-top: 4px; }
assistant-avatar, user-avatar { width: 32px; height: 32px; border-radius: 50%; background: #f3f4f6; display: inline-flex; align-items: center; justify-content: center; box-shadow: var(--shadow, 0 1px 2px rgba(0,0,0,0.1)); }
user-avatar { background: #dbeafe; }

/* Message Bubble - vertical container */
message-bubble { display: flex; flex-direction: column; flex: 1; }
message-bubble[alignment="vertical"] { align-items: stretch; }

/* Message Content */
message-content { background: var(--assistant-bg, #ffffff); color: var(--assistant-text, #111827); border-radius: var(--bubble-radius, 18px); padding:14px 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.04); }
message-container[type="user"] message-content { background: var(--user-bg, #2563eb); color: var(--user-text, #ffffff); }
message-container[type="system"] message-content { background: var(--system-bg, #f1f3f4); color: var(--system-text, #333); }
message-text { line-height: 1.5; display:block; font-size: 14px; }
message-text p { margin: 0 0 8px; }
message-text p:last-child { margin-bottom: 0; }
message-text .md-list { margin: 6px 0 8px 20px; padding: 0; list-style: disc; }
message-text .md-list li { margin: 3px 0; }
/* Streaming/typing indicator */
message-container[data-streaming="true"] message-text::after {
	content: '▍';
	display: inline-block;
	margin-left: 2px;
	opacity: 0.7;
	animation: blink 1s steps(1, start) infinite;
}
@keyframes blink { 50% { opacity: 0.1; } }

/* Message Metadata - replaces message-footer */
message-metadata { display:flex; align-items:center; gap:12px; margin-top: 8px; font-size: 12px; color: var(--muted, #6b7280); justify-content: flex-start; }
message-container[type="user"] message-metadata { justify-content: flex-end; }

/* Duration badge */
duration-badge { display:inline-flex; align-items:center; padding:2px 8px; border:1px solid var(--border, #e5e5e5); border-radius: 10px; font-size: 11px; color: var(--muted, #6b7280); background: rgba(255,255,255,0.8); }

/* Copy and Speaker buttons */
copy-button, speaker-button { background:#fff; border:1px solid var(--border, #e5e5e5); color: var(--muted, #6b7280); padding:4px 8px; border-radius:8px; cursor:pointer; font-size:12px; display:inline-flex; align-items:center; gap:4px; }
copy-button:hover, speaker-button:hover { background: #f9fafb; border-color: #d1d5db; }

/* Speaker button states - will be managed via JS icon replacement */
speaker-button[data-state="playing"] { color: var(--accent, #2563eb); }
speaker-button[data-state="stopped"] { color: var(--muted, #6b7280); }

/* Speaker progress indicator - only visible when playing */
speaker-progress { width: 48px; height: 4px; background: rgba(0,0,0,.08); border-radius: 2px; position: relative; overflow: hidden; margin-left: 4px; }
speaker-progress::after { content: ''; position: absolute; left: 0; top:0; bottom:0; width: var(--value, 0%); background: var(--accent, #2563eb); border-radius: 2px; }
speaker-progress[style*="display: none"] { display: none !important; }

input-area { grid-area: input; background:#fff; border-top:1px solid var(--border, #e5e5e5); padding:16px 20px; }
input-container { display:flex; align-items:center; gap:12px; background:#f8f9fa; border:1px solid var(--border, #e5e5e5); border-radius:24px; padding:12px 16px; }
text-input { flex:1; min-height: 24px; font:inherit; display:block; }
text-input input, text-input textarea { width: 100%; border: none; background: transparent; outline: none; font: inherit; color: var(--text, #222); padding: 0; resize: none; font-size: 14px; line-height: 1.4; }
text-input input::placeholder, text-input textarea::placeholder { color: var(--muted, #9ca3af); }
attachment-button, voice-button, settings-button, send-button { background:none; border:none; font-size:18px; cursor:pointer; padding:8px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center; }
attachment-button svg, voice-button svg, settings-button svg, send-button svg { width: 20px; height: 20px; }
send-button { color: var(--accent, #2563eb); background: var(--accent, #2563eb); border-radius: 12px; padding: 8px; }
send-button svg { color: white; }
attachment-button:hover, voice-button:hover, settings-button:hover { background: rgba(0,0,0,.06); }
send-button:hover { background: #1d4ed8; }

/* Suggested actions */
suggested-actions { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
suggested-actions.hidden { display: none !important; }
suggested-actions.fade-out { opacity: 0; transition: opacity .24s ease; }
suggestion-button, domain-button { background: #fff; border: 1px solid var(--border, #e5e5e5); border-radius: 16px; padding: 8px 12px; font: inherit; color: var(--text); cursor: pointer; font-size: 13px; line-height: 1.2; }
suggestion-button:hover, domain-button:hover { background: #f8f9fa; border-color: var(--accent, #2563eb); }
suggested-actions.domain-grid { display: flex; flex-wrap: wrap; gap: 8px; }

/* Speaking state visual (optional) */
message-container[data-speaking="true"] message-metadata timestamp::after {
	content: ' • Speaking';
	color: var(--accent, #2563eb);
}

/* Host attribute-driven visibility (no inline styles) */
:host([hide-header="true"]) chat-header { display: none; }
:host([show-attach="false"]) attachment-button { display: none; }
:host([show-voice="false"]) voice-button { display: none; }
:host([show-settings="false"]) settings-button { display: none; }
